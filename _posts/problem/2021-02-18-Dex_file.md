---
title: Android - Dex file
categories: [problem]
comments: true
---

# Problem

라이브러리를 추가하자 "Cannot fit requested classes in a single dex file" 이라는 메시지와 함께 컴파일 오류가 나타났다.

# Explanation

### 안드로이드 공식 문서

- '앱 및 앱이 참조하는 라이브러리에서 메서드가 65,536개를 초과하면 앱이 Android 빌드 아키텍처의 제한에 도달했음을 알리는 빌드 오류가 발생합니다.'

안드로이드 프로젝트는 컴파일을 할 때 dex 바이트코드 파일이 생성되는데 65,536이라는 숫자는 이 파일 내에서 코드가 호출할 수 있는 참조의 총 개수를 나타낸다. 그래서 수를 초과하면 오류가 발생하는 것이다.

(※ 65,536은 64 X 1024이므로 **64K 참조 제한** 문제라고도 부른다.)

참고 메서드는 라이브러리 내부의 메서드도 포함되므로, 라이브러리를 추가하여 오류가 발생했던 것이다.

# Solution

dex 파일을 한 개가 아닌 여러 개를 사용하도록 설정하면 된다.

```
android {

	...

    defaultConfig {
    	...

        multiDexEnabled true // << 추가
    }

    ...
}
```

app 레벨의 build.gradle 파일에 위와 같이 multiDexEnabled true를 추가한다.

```
dependencies {
    ...

    implementation 'com.android.support:multidex:1.0.3' // << 추가
}
```

마찬가지로 app 레벨의 build.gradle 파일에 위와 같이 의존성 패키지를 추가한다.

이렇게 하면 컴파일 할 때 다중으로 dex 파일을 읽고 빌드할 수 있게 해주므로 문제가 해결된다.
