---
title: Jest(Test)
categories: [Web]
comments: true
---

# Jest

`Contestbox` 프로젝트를 진행하며, github의 Action을 활용하여 CI 과정을 접해 보았는데, 빌드를 하기 전에 테스트를 하는 과정이 필요하다는 것을 알게 되었다. `javascript` 프로젝트의 테스트를 도와주고 리액트에서 사용하는 `jest` 테스트 프레임워크를 알게 되었다.

CI/CD Note

[CI/CD](https://www.notion.so/haena3230/CI-CD-3c242a8682b94966a078c9126597dbba)

Jest를 통해 간단한 테스트를 몇번 진행 해 보았지만, `Contestbox` 에서 제공하는 기능들이 많지 않고, `사이드이펙트`가 발생할 가능성이 적다고 판단하여 우선 `빌드`만 우선 `자동화` 해두고, 제공하는 기능이 많아져 버그 관리가 필요한 시점에 테스트 자동화를 추가하는 것으로 방향을 정했다.

## 테스트의 필요성

앱을 릴리즈 한 후 `버그`가 발생하게 되면 서비스를 제공하는 데에 큰 차질이 발생할 수 있고, 수정하는 데에 많은 시간과 비용이 소요된다. 따라서 테스트를 자동화 하여 경우의 수를 따져 `CI` 단계에서 문제를 발생할 수 있도록 하는 것이 코드의 질을 향상 시킬 수 있다.

## 테스트의 종류

테스트의 종류에는 여러가지가 있지만, 가장 간단하고 자주 사용되는 테스트는 아래 2가지가 있다.

1. `유닛 테스트`: 가장 조그마한 단위로 테스트하여 하나의 컴포넌트씩 테스트하는 것
2. `통합 테스트`: 다른 컴포넌트들끼리의 상관 관계까지 테스트하는 것

## React Native && jest

- `React native` 에는 React `Component`를 순수한 `JS 객체`로 `렌더링` 하는데 사용할 수 있는 'react-test-renderer'라고 하는 React 렌더러가 존재한다.
- `package.json`에 있는 jest `preset`을 `react-native`로 설정하면 별도의 복잡한 설정 없이 사용할 수 있다.
- '**tests**' 폴더 내부에 있는 파일은 기본적으로 `jest`로 테스트할 시에 자동으로 테스팅 파일에 포함이 된다.
- 필요한 라이브러리들을 개발 의존성으로 설치하여 사용한다.
- jest에는 테스트에 필요한 다양한 메서드들이 존재한다.

## 스냅샷 테스팅

컴파일한 상태를 `Snapshot`으로 저장 해 매 테스트마다 처음 상태와 같은 사진이 나오는지 비교하는 테스팅이다.

`Component`를 `render`하고 `expect`를 통해 프로그램에게 테스트 대상이 어때야 한다는 내용을 전달 해주면 된다.

- 스냅샷이 기존 스냅샷과 일치하는지 → `expect(rendered).toMatchSnapshot();`
- 컴포넌트가 `null`, `undefined` 같이 `falsy` 한 값을 가지지는 않았는지 → `expect(rendered).toBeTruthy();`

프로젝트 터미널에 `jest` 혹은 `yarn test` 를 통해 테스트를 실행 할 수 있다.

처음에 이 테스트를 실행하면 `Snapshot missing` 경고가 나오는데데  `yarn test -u` 로 최신 스냅샷을 다시 찍어 업데이트 한다는 옵션을 함께 주면 된다.

그럼 `__tests__`디렉토리에 `__snapshots__` 폴더가 생성되며 미묘하게 다른 코드가 생성된다.

UI가 예측하지 못하게 바뀌는 것을 방지하도록 할 때 사용되는 유용한 툴로 요소가 변경된다면 다시 스냅샷을 찍어야 한다.

## 유닛테스트 → 통합테스트

`mocking`을 위한 `jest.fn()`, 이벤트로써 상호작용하는 컴포넌트들을 트리거하는데 사용되는 `fireEvent`, 매개변수로 전달된 텍스트를 가진 컴포넌트 노드가 존재하는지 테스트 및 리턴하는 함수인 `getByText`와 같은 메서드를 테스팅 라이브러리에서는 `Queries`로 통칭하는데 `Variant`로 알려진 접두사와 Queries로 알려진 접미사의 합성으로 구성된다.

- Variant
  - getBy\* : 조건에 일치하는 엘리먼트를 하나 선택한다. 없다면 테스트 실패로 처리한다.
  - getAllBy\* : 조건에 일치하는 엘리먼트를 여러개 선택한다. 없다면 테스트 실패로 처리한다.
  - queryBy\* : 조건에 일치하는 엘리먼트를 하나 선택한다. 존재하지 않아도 실패는 하지 않는다.
  - queryAllBy\* : 조건에 일치하는 엘리먼트를 여러개 선택한다. 존재하지 않아도 실패는 하지 않는다.
  - findBy\* : 조건에 일치하는 엘리먼트를 하나 선택한다. 단 Promise 객체를 리턴하며 조건에 만족하는 엘리먼트가 나타날 때 까지 기다리고 만약 4500ms 내에 발견되지 않으면 테스트는 실패한다.
  - findAllBy\* : 조건에 일치하는 엘리먼트를 여러개 선택한다. 단 Promise 객체를 리턴하며 조건에 만족하는 엘리먼트가 나타날 때 까지 기다리고 만약 4500ms 내에 발견되지 않으면 테스트는 실패한다.
- Queries( 주로 사용하는 것만 다룸 )
  - ByText : 엘리먼트가 가진 텍스트 값으로 선택
  - ByAltText : 엘리먼트가 가진 alt 속성으로 선택
  - ByTestId : 엘리먼트가 가진 TestId 속성으로 선택

단위 테스트가 끝나면 한단계 위의 컴포넌트로 이동해 함께 있어도 잘 동작하는지 통합 테스트를 진행하면 된다.

## 테스트 결과 확인

내가 작성한 코드가 모두 테스트 되었는지 알고싶다면 아래 명령어로 jest에서 제공하는 report를 확인하면 된다.

```jsx
$ yarn test **--**coverage
```

위 명령어를 실행하면 `coverage` 라는 폴더가 생성되며 `coverage report` 를 이용 할 수 있게 된다.

### React Native Testing Library 공식 문서

[React Native Testing Library | React Native Testing Library](https://callstack.github.io/react-native-testing-library/)
